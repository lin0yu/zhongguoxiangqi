# 内网中国象棋系统测试与验收方案

## 目标
- 验证访问控制（RBAC、IP 白名单、MAC 绑定）按预期工作。
- 验证前端交互反馈（成功提示、错误提示、动画与音效）稳定可靠。
- 验证性能目标（所有关键反馈响应时间 < 300ms）。
- 验证性能监控看板与服务端日志/告警可用。
- 完成 100% 功能测试覆盖，支持 500 并发压力测试，收集 ≥50 名内部用户反馈。

## 测试环境
- 操作系统：Windows（内网环境，端口 `8000` 可访问）。
- 服务端：`node server/server.js`。
- 前端：`http://localhost:8000/` 或内网机器名/IP。
- 配置：`server/config.json` 与 `js/config.js`。

## 功能测试项（100% 覆盖）
1. 认证与权限
   - 成功登录（管理员/普通用户/访客）。
   - 登录失败提示（错误代码、解决方案、自动上报）。
   - 管理员可见性能看板，普通用户/访客不可见。
2. 安全校验
   - IP 白名单命中与拒绝（服务端返回 403，触发告警）。
   - MAC 绑定命中与拒绝（同网段 ARP 解析，返回 403）。
   - 连续登录失败超过阈值，触发服务端告警与前端错误提示。
3. 访问日志
   - 成功与失败请求均写日志（时间戳、IP、路径、结果）。
4. 游戏交互
   - 选择棋子、合法落点高亮、走子、吃子、悔棋、重做。
   - 导入/导出、保存/读取本地存档。
   - 将军、将死、僵局与“飞将”判定。
5. 成功反馈
   - 普通/重要/关键级成功提示样式与文案。
   - 粒子动画与音效触发。
6. 错误反馈
   - 错误代码归类、上下文解决方案展示。
   - 自动上报到服务端 `/api/report-error`。

## 性能测试
- 目标：关键反馈响应时间 < 300ms。
- 监控：前端 `js/metrics.js` 性能看板；服务端 `/api/report-performance` 聚合。
- 方法：
  1) 手工操作：在浏览器中进行点击、走子、登录操作，观察看板统计。
  2) 脚本压力（500 并发）示例（PowerShell）：
     - 管理员登录接口：
       ```powershell
       $jobs = @();
       for ($i=0; $i -lt 500; $i++) {
         $jobs += Start-Job -ScriptBlock {
           Invoke-WebRequest -Method Post -Uri "http://<server>:8000/api/login" -Body (@{username='admin';password='admin123'} | ConvertTo-Json) -ContentType 'application/json'
         }
       }
       $jobs | ForEach-Object { Receive-Job -Job $_ -Wait }
       ```
     - 观察服务端输出、告警与前端看板汇总。

## 用户体验反馈
- 招募 ≥50 名内部用户，覆盖不同角色与部门。
- 收集内容：登录与权限认知、交互提示清晰度、错误信息可操作性、响应速度体感。
- 汇总方式：导出前端性能看板数据 + 统一问卷（建议使用公司内部表单）。

## 验收标准
- 功能用例全部通过（见“功能测试项”）。
- 压力测试 500 并发，服务端稳定，平均响应 < 300ms；告警与日志正常。
- 收集并分析 ≥50 名用户反馈，问题闭环处理。
- 管理员可见性能看板数据与服务端汇总一致。

## 风险与注意
- MAC 绑定基于 ARP，仅在同网段有效；跨网段需替代方案（如 NAC）。
- Windows 防火墙需允许端口 8000 入站访问（由运维统一配置）。
- 白名单配置需及时维护，避免误封；建议启用灰度策略与双人复核。

## 回归与持续集成建议
- 每次变更需更新 `COMMIT_NOTES.md`，描述影响范围与测试建议。
- 建议引入简单的集成测试脚本（Node 原生 `assert`/`http`），覆盖认证、白名单与日志接口。